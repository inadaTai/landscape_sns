# README

 # Landscape SNSをご覧いただきありがとうございます。

READMEには進行状況の記載と今回の課題に対する所感の記載を行っております。

下記はローカル(docker環境で)db:create、migrateした後、seedまで行うコマンドを行なった後にみれます。

パスワードpassword:foobar

メールアドレス：example@railstutorial.org(名前：example、ユーザー名：Example User)備考：admin有

下記は本番環境(herokuデプロイ済み)のテスト用のアカウントです、ログインフォームより確認が可能となります、また「test@gmail.com」の方のアカウントに対しいいねとフォローを別のアカウントから行なっておきましたのでヘッダーの通知欄の未読時のマーク確認ができます。

URL：https://landscape-sns.herokuapp.com/

パスワード(下記の２つのアカウント共通)password:foobar

メールアドレス：test@gmail.com（名前：テスト、ユーザー名：test_07）

メールアドレス：example@railstutorial.org(名前：example、ユーザー名：Example User)備考：admin有

備考：adminの概念はありますがエディットに退会のボタンがありますので今回のサイト仕様では将来用のカラムとなります。（例：将来管理者権限アカウントでしかできない何かをやる様な仕様など）

テスト用のアカウントを使用しフォローの確認といいねの通知の確認ができます、また本番環境も同様のアカウントで動作チェックができます。

※本番環境でも退会などの動作確認しても大丈夫ですので、ぜひ評価よろしくお願い致します。


4月18日（土）

ユーザーコントローラまたはユーザーモデルとサイトのデザインを実装。

4月19日(日)

ユーザーのログイン機構の実装　（新規登録画面）

I18nを使用したエラーの日本語化へ対応

本番環境にてSSL通信できるようにコンフィグより設定変更

4月20日（月）

cookieを使用した記憶トークン実装（これによりユーザーのログイン状況を保持）

Rspec一部のテストをリファクタリング実施

ログイン後のユーザー情報の編集ページ実装

4月21日（火)

micropost実装実施

4月22日 (水)

フォロー機能実装(Relationship)

プロフィールページ自己紹介などが表示されるようデザイン変更(users/1やusers/2...)

herokuでfogのインストールがうまくいかないためpgのバージョンを上げました。

4月23日 (木)

facebookログイン実装

CarrierWaveのファイル選択で書き漏れがあった為修正(jpegを選択できるようにしました。)

利用規約、about、ヘルプ、お問い合わせのページレイアウトを修正

検索バーを設置しました、コンテンツや調べたいユーザーさんの名前を入れることにより抽出します。

yieldで判別するので該当ページにて検索したい言葉で出るような形となります。

①root_pathまたはプロフィールページだと投稿物の言葉で結果を拾ってきます。

②ユーザーの一覧ページで使用すると言葉に応じてユーザーを拾ってきます。

4月24日(金)

投稿物(micropost)に対しコメントを可能としました。

備考：コメントコントローラ内のdef createで失敗した際renderしてない理由としては@comment.saveされていないのでページを変えたらコメントは消えてますが一見ユーザー視点から見ると無効な投稿を行いエラーが出ていますが投稿出来てるようにviewでは見えるためredirect_toを採用いたしました。

micropostに対していいね機能　（お気に入り）を実装

4月25日(土)

通知機能を実装しました

①投稿物(micropost)に対しコメント、いいねがついた場合は通知がきます。

②他のユーザーからフォローされた場合も通知がくるようになっています。

また上記で未読の通知がある場合は通知の右上に赤い○の点が付きます。（自分の投稿にてコメントを書くと動作確認ができます。）

Rspecのsystemsでログインに関してapplicationヘルパーにて「login_system」メソッドを使いテストの行を減らすリファクタリングと新規テスト追加を実施

Rspecにてfull_titleのヘルパーメソッドに対し増えたページに対しての追加テストを書きました。

ユーザーログインのところへ退会がちゃんと出来るまでのsystemテストを追加しました。

rails6.1にてupdate_attributesが使用できなくなるのでupdateに書き換えを実施しました。

custom.scssにてフルサイズでサイトを見ている分には問題なしですがタブがミドルサイズの場合はユーザーのアイコンが他人の投稿した写真と重なる状態になっていたので.gravatarのcssを修正しました。

備考：不具合箇所としてfacebookログイン時ユーザーのパスワードはnilになるため、has_secure_passwordをfalse(※falseにしないとローカルでは接続可だがherokuを使う本番環境で接続不可になります。)にして尚且つ通常のエディットページ（パスワードエディットではない方）のページ更新はパスワード入力不要のためallow_nilをtrueにしており、そのため新規登録時などにnilでも(未入力でエラーが出ず)登録可能となっていた為createとパスワードエディットのupdateアクションにif文の条件で&&を追記しバリデーションに合う様な設定にいたしました。（空欄やempty(スペースキー)を使った入力は不可能となっています。）

4月27日でherokuにて動作を確認した環境を書きに示しています。

iphone11 (smoozeブラウザ)

備考：横３列表示はデザインのpxの数の都合上不可の模様、しかしデザインの崩れは確認されていません。パソコン同様に一通りの挙動確認もOK

macbook pro 2018version

備考：safariとgooglechorome

開発環境ではの挙動を確認また、AjaxについてはをOFFにしても期待通りの挙動は行っており画像の投稿に横３列の表示など期待通りの動きをしています。


4月26〜4月27日（日〜月）

これからの作業でコンテナ技術を使用したdockerにて起動や編集が可能な様に作業を開始。

備考：ブランチとしてはadd-dockerブランチが作品の最後となります、コマンドは下記にまとめております。

docker導入後ローカルとテストが変化している箇所がございます

gem 'database_cleaner'を追加しました。

備考：Mysqlではauto_incrementでid値が管理されておりrspecのテストを実施するたびにmicropostとuserを作るテスト(新規登録の確認のテストなど)で毎回出力の値が１ずつ増えていくためgemを導入しリセットする様にしました。

上記ですが、docker導入前のローカル環境であればmodelテストでもテストは通ります。


もし、dockerにて立ち上がらないという場合には最後から１つ手前のadd-notficationというブランチであれば「docker file」もないので「rails s」で立ち上がります。

docker環境でdbはMYSQLにてlocalhost:3000へアクセスを確認しました。

下記のコマンドを順番に使用し動作を確認済み。

イメージをビルドするため

①docker-compose build

コンテナを立ち上げるため

②docker-compose up -d

コンテナを立ち上げ後migrateをしないとアクセスしてもエラーが出てしまうので下記のコマンドを行います。

③docker-compose run web bin/rake db:create db:migrate db:seed

ステータス状況を確認するためのコマンドです。

④docker-compose ps

ステータス状況が大丈夫であれば最後に下記を行います。

⑤docker-compose up

Dockerのコンテナの中でテストを走らせたい場合は下記のコマンドを行なってください下記でコンテナの中で作業ができます。

⑥docker-compose exec web bash

Rspecのテストが検証したい場合は下記コマンドです。（全体のテストが走ります。）

⑦rspec

停止したい場合は⑧のコマンドです、また見終わりコンテナを削除したい場合は⑨を行ってくださいませ。(両方とも実行したい場合はdownをするとstopコマンドをしなくてもstop致します。)

⑧docker-compose stop

⑨docker-compose down


下記４点は後日書きます。

・自分が苦労した点

後にDeviceの導入を渋った結果Userモデル完成後にdeviceを導入するとUserモデルのコンフリクトが起きることに気づいたので今回はdeviceなしでomnioath単体でif文で分岐し既存のログイン機構に対しfacebookログイン実装を行いました。

機能要項に逸れてしまうのでスキーマにあるユーザーテーブルをrails db:dropかロールバックしてでも導入をした方がよかったのかなと思う部分でもありました。

またrails6.0はyarnしないとローカルではjavaは機能するものの本番環境ではモジュールがないと怒られエラーが返るのでその点に気づくまでに時間がかかりました、またこのプロジェクトでもlikeやフォローについてAjaxが不安定な点が作成中で見受けられ提出前に修正はしましたが、まだまだ学習の段階に使うものではないのかなぁと思いつつも勉強になった点もたくさん得られたと思いました。

・学んだ点

Qiitaにてrspecの書き方について基礎的な書き方を学びを得ました。
Likeやcommentの機能などrailsチュートリアルの範疇を超えた場合は参考記事が検索してもなかったため自分の中でこんな感じのテストかなと思いつつ書きました、至らない点やテストの項目でこんなところも書いた方が良いという指摘がある場合は指摘が欲しいです。

またDockerを導入しコンテナ内からrspecを走らせた場合エラーがたくさん出たのでコンテナの中でDockerに適応した環境の構築を行わなければならないという点を学べました。

・自慢したい点

Rails6.0.2でローカル環境にて作成を行いました。また、Dockerを導入したので今後の開発ではコンテナの中で作業できる様にしました！

・相談したい点

①今回の作成したものはスクールに入り質問もRspecのpostリクエストの件の質問1回程度しかできず他の生徒さんと比べ作成物に対し私は気づきが少ない様に感じてしまいました。
初めての提出型の課題を作成しましたが他の生徒さんと比べどのレベルの出来なのかな？と思いました。

またどの様な感じで学習を行えばたくさんの質問ができる様な感じになるのかな？と思いました。(気づきを得つつ学習を行いたいという意)

②またエンジニアとして本来であれば自分たちでロジックを考え保守性の高いプログラムを組み他にも有用なgemを選ぶなどあると思うのですがまだまだ経験が浅いので自分には考える力がたりてないの様に思えましたどのように学習をしたら良いのだろう？と思いました。
